<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATSOGO Customer Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Define CSS variables for colors - consistent with dashboard */
        :root {
            --bg-primary: #1a202c; /* Dark background */
            --bg-secondary: #2d3748; /* Slightly lighter background for cards/forms */
            --bg-tertiary: #4a5568; /* Even lighter for input backgrounds/hover */
            --text-primary: #e2e8f0; /* Light text */
            --text-secondary: #a0aec0; /* Lighter gray text */
            --border-color: #4a5568; /* Border color */
        }

        /* Light mode overrides */
        body.light-mode {
            --bg-primary: #f7fafc; /* Light background */
            --bg-secondary: #ffffff; /* White background for cards/forms */
            --bg-tertiary: #edf2f7; /* Light gray for input backgrounds/hover */
            --text-primary: #2d3748; /* Dark text */ 
            --text-secondary: #4a5568; /* Darker gray text */
            --border-color: #e2e8f0; /* Light border color */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease; /* Smooth theme transition */
        }

        /* Modal specific styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: var(--bg-secondary);
            border-radius: 0.5rem;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }
        .modal-overlay.show .modal-content {
            transform: translateY(0);
        }
    </style>
</head>
<body id="theme-body" class="flex items-center justify-center min-h-screen p-4">

    <div class="bg-[var(--bg-secondary)] rounded-lg shadow-xl p-8 w-full max-w-md border border-[var(--border-color)]">
        <div class="flex items-center justify-between mb-8">
            <h2 class="text-4xl font-extrabold text-indigo-400">ATSOGO Login</h2>
            <button id="theme-toggle" class="text-[var(--text-secondary)] hover:text-[var(--text-primary)] focus:outline-none p-2 rounded-full hover:bg-[var(--bg-tertiary)] transition-colors duration-200">
                <i data-lucide="moon" id="theme-icon" class="w-6 h-6"></i>
            </button>
        </div>

        <form class="space-y-6">
            <div>
                <label for="email" class="block text-sm font-medium text-[var(--text-secondary)] mb-2">Email Address</label>
                <div class="relative">
                    <input type="email" id="email" name="email" class="w-full pl-10 pr-4 py-2 rounded-lg bg-[var(--bg-tertiary)] text-[var(--text-primary)] placeholder-[var(--text-secondary)] focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors duration-200 border border-[var(--border-color)]" placeholder="your@example.com">
                    <i data-lucide="mail" class="w-5 h-5 text-[var(--text-secondary)] absolute left-3 top-1/2 transform -translate-y-1/2"></i>
                </div>
            </div>
            <div>
                <label for="password" class="block text-sm font-medium text-[var(--text-secondary)] mb-2">Password</label>
                <div class="relative">
                    <input type="password" id="password" name="password" class="w-full pl-10 pr-10 py-2 rounded-lg bg-[var(--bg-tertiary)] text-[var(--text-primary)] placeholder-[var(--text-secondary)] focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors duration-200 border border-[var(--border-color)]" placeholder="••••••••">
                    <i data-lucide="lock" class="w-5 h-5 text-[var(--text-secondary)] absolute left-3 top-1/2 transform -translate-y-1/2"></i>
                    <button type="button" id="toggle-password-visibility" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-[var(--text-secondary)] hover:text-[var(--text-primary)] focus:outline-none">
                        <i data-lucide="eye" id="password-toggle-icon" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>

            <div class="flex items-center justify-between mt-6">
                <div class="flex items-center">
                    <input type="checkbox" id="remember_me" name="remember_me" class="h-4 w-4 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500 bg-[var(--bg-tertiary)] cursor-pointer">
                    <label for="remember_me" class="ml-2 block text-sm text-[var(--text-secondary)]">Remember me</label>
                </div>
                <button type="button" id="forgot-password-btn" class="text-sm text-indigo-400 hover:text-indigo-300 transition-colors duration-200 focus:outline-none">Forgot Password?</button>
            </div>

            <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)] transition-all duration-200 shadow-md transform hover:scale-[1.01]">
                Login
            </button>
        </form>

        <p class="text-center text-sm text-[var(--text-secondary)] mt-8">
            Don't have an account?
            <a href="atsogo-customer-signup.html" class="text-indigo-400 hover:text-indigo-300 transition-colors duration-200 font-medium">Sign Up</a>
        </p>
    </div>

    <div id="forgot-password-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold text-[var(--text-primary)]">Forgot Password Assistant</h3>
                <button id="close-forgot-password-modal" class="text-[var(--text-secondary)] hover:text-[var(--text-primary)] focus:outline-none">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <div class="mb-4">
                <p class="text-[var(--text-primary)] mb-2">Tell me what you remember about your account or password, and I'll try to help you recover it (e.g., "I used my work email," "It had my pet's name").</p>
                <textarea id="recovery-details-input" rows="4" class="w-full px-4 py-2 rounded-lg bg-[var(--bg-tertiary)] text-[var(--text-primary)] placeholder-[var(--text-secondary)] focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors duration-200" placeholder="e.g., I registered with my Gmail, and my password might have included my birth year."></textarea>
            </div>
            <button id="get-recovery-advice-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)] transition-all duration-200 shadow-md flex items-center justify-center">
                <span id="recovery-button-text">Get Recovery Advice</span>
                <svg id="recovery-loading-spinner" class="animate-spin h-5 w-5 text-white ml-3 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </button>
            <div class="mt-6">
                <h4 class="text-md font-semibold text-[var(--text-primary)] mb-2">AI Recovery Advice:</h4>
                <div id="recovery-advice-output" class="p-4 rounded-lg bg-[var(--bg-tertiary)] text-[var(--text-primary)] min-h-[100px] max-h-[200px] overflow-y-auto whitespace-pre-wrap">
                    </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        const themeToggleBtn = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');
        const themeBody = document.getElementById('theme-body');

        // Forgot Password Modal elements
        const forgotPasswordBtn = document.getElementById('forgot-password-btn');
        const forgotPasswordModal = document.getElementById('forgot-password-modal');
        const closeForgotPasswordModalBtn = document.getElementById('close-forgot-password-modal');
        const recoveryDetailsInput = document.getElementById('recovery-details-input');
        const getRecoveryAdviceBtn = document.getElementById('get-recovery-advice-btn');
        const recoveryAdviceOutput = document.getElementById('recovery-advice-output');
        const recoveryLoadingSpinner = document.getElementById('recovery-loading-spinner');
        const recoveryButtonText = document.getElementById('recovery-button-text');

        // Password Visibility Toggle elements
        const passwordInput = document.getElementById('password');
        const togglePasswordVisibilityBtn = document.getElementById('toggle-password-visibility');
        const passwordToggleIcon = document.getElementById('password-toggle-icon');

        // Theme management functions
        function setTheme(mode) {
            if (mode === 'light') {
                themeBody.classList.add('light-mode');
            } else {
                themeBody.classList.remove('light-mode');
            }
            // Always set the icon to 'moon' regardless of the mode
            themeIcon.setAttribute('data-lucide', 'moon');
            lucide.createIcons(); // Re-render icons after changing data-lucide attribute
        }

        // Toggle theme manually via button
        themeToggleBtn.addEventListener('click', () => {
            if (themeBody.classList.contains('light-mode')) {
                setTheme('dark');
                localStorage.setItem('theme', 'dark');
            } else {
                setTheme('light');
                localStorage.setItem('theme', 'light');
            }
        });

        // Listen for system theme changes
        const prefersLightScheme = window.matchMedia('(prefers-color-scheme: light)');

        function handleSystemThemeChange(e) {
            // Only apply system preference if user hasn't manually set a theme
            if (!localStorage.getItem('theme')) {
                setTheme(e.matches ? 'light' : 'dark');
            }
        }

        prefersLightScheme.addEventListener('change', handleSystemThemeChange);

        // Set initial theme on load
        window.onload = () => {
            const savedTheme = localStorage.getItem('theme');

            if (savedTheme) {
                // If a theme is saved in localStorage, use it
                setTheme(savedTheme);
            } else {
                // Otherwise, use the system's preferred color scheme
                setTheme(prefersLightScheme.matches ? 'light' : 'dark');
            }
        };

        // Forgot Password AI Assistant functionality
        forgotPasswordBtn.addEventListener('click', () => {
            forgotPasswordModal.classList.add('show');
            recoveryDetailsInput.value = ''; // Clear previous input
            recoveryAdviceOutput.textContent = ''; // Clear previous output
        });

        closeForgotPasswordModalBtn.addEventListener('click', () => {
            forgotPasswordModal.classList.remove('show');
        });

        getRecoveryAdviceBtn.addEventListener('click', async () => {
            const details = recoveryDetailsInput.value.trim();
            if (!details) {
                recoveryAdviceOutput.textContent = 'Please provide some details to get recovery advice.';
                return;
            }

            // Show loading spinner
            recoveryLoadingSpinner.classList.remove('hidden');
            recoveryButtonText.textContent = 'Getting Advice...';
            getRecoveryAdviceBtn.disabled = true; // Disable button during generation
            recoveryAdviceOutput.textContent = ''; // Clear previous output

            try {
                const prompt = `The user is trying to recover their account. They remember the following details: "${details}". Provide general, secure advice on how they might recover their password. Do NOT ask for sensitive information. Focus on common recovery steps like checking email, security questions, or contacting support. Keep it concise and helpful.`;

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = ""; // If you want to use models other than gemini-2.0-flash or imagen-3.0-generate-002, provide an API key here. Otherwise, leave this as-is.
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const generatedText = result.candidates[0].content.parts[0].text;
                    recoveryAdviceOutput.textContent = generatedText;
                } else {
                    recoveryAdviceOutput.textContent = 'Error: Could not get recovery advice. Please try again.';
                    console.error('Gemini API response structure unexpected:', result);
                }
            } catch (error) {
                recoveryAdviceOutput.textContent = 'Error: Failed to connect to the AI service. Please check your network or try again later.';
                console.error('Error calling Gemini API:', error);
            } finally {
                // Hide loading spinner
                recoveryLoadingSpinner.classList.add('hidden');
                recoveryButtonText.textContent = 'Get Recovery Advice';
                getRecoveryAdviceBtn.disabled = false; // Re-enable button
            }
        });

        // Password Visibility Toggle functionality
        togglePasswordVisibilityBtn.addEventListener('click', () => {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);

            // Toggle the eye icon
            if (type === 'password') {
                passwordToggleIcon.setAttribute('data-lucide', 'eye');
            } else {
                passwordToggleIcon.setAttribute('data-lucide', 'eye-off');
            }
            lucide.createIcons(); // Re-render icons
        });
    </script>
</body>
</html>
